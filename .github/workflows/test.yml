name: Go Test

on:
    push:
        branches: [main]
    pull_request:
        branches: [main]

jobs:
    test:
        runs-on: ubuntu-latest
        steps:
            - name: Set up Go 1.x
              uses: actions/setup-go@v2
              with:
                  go-version: ^1.18
            - name: Check out code into the Go module directory
              uses: actions/checkout@v2
            - name: Get dependencies
              run: go get -v -t ./...
            - name: Create Service Account JSON
              run: |
                  echo "${{ secrets.SERVICE_ACCOUNT_JSON }}" > service_account.json
                  export SERVICE_ACCOUNT_JSON=service_account.json
            - name: Test
              run: go test ./cmd/app/...
            - name: Cleanup Service Account JSON
              run: rm service_account.json
